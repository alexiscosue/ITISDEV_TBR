<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://unpkg.com/scrollreveal"></script>
    <link rel="icon" type="image/png" href="assets/logo.png">
    <title>Membership</title>
  </head>
  <body>
    <nav>
      <div class="nav__logo">
        <img src="assets/logo.png" alt="logo" />
        <span>Breathing Room PH</span>
      </div>
      <ul class="nav__links">
        <li class="link"><a href="index.html">Home</a></li>
        <li class="link"><a href="classes.html">Classes</a></li>
        <li class="link"><a href="membership.html">Membership</a></li>
        <li class="link"><a href="index.html#stories">About</a></li>
        <li class="link"><a href="index.html#posts">Blog</a></li>
        <li class="link"><a href="#contact">Contact</a></li>
      </ul>
      <div class="nav__profile">
        <span id="userGreeting" style="font-size: 1rem; color: var(--text-dark); margin-right: 10px;"></span>
        <a id="profileLink"><i class="ri-user-line"></i></a>
        <script>
          fetch('/check-auth')
            .then(res => res.json())
            .then(data => {
              const link = document.getElementById('profileLink');
              const greeting = document.getElementById('userGreeting');
              if (data.loggedIn) {
                link.href = '/user_profile';
                greeting.textContent = `Hi, ${data.user.firstname}`;
              } else {
                link.href = '/login.html';
                greeting.textContent = ``;
              }
            });
        </script>
      </div>
    </nav>  

    <section class="banner">
      <div class="section__container banner__container1">
        <div class="banner__card">
          <h4>Membership Plans</h4>
          <p>Choose a plan that fits your lifestyle and start your wellness journey today.</p>
        </div>
      </div>
    </section>

    <section class="membership" id="membership">
      <div class="section__container membership__container">
        <div id="membershipContent"></div>
      </div>
    </section>

    <script>
      function handleMembershipSelect(plan) {
        fetch('/check-auth')
          .then(res => res.json())
          .then(data => {
            if (!data.loggedIn) {
              alert('Please log in to continue.');
              window.location.href = '/login.html';
            } else {
              localStorage.setItem('selectedMembership', JSON.stringify(plan));
              window.location.href = 'payment.html';
            }
          });
      }

      fetch('/api/memberships')
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById('membershipContent');
          for (const category in data) {
            const section = document.createElement('div');
            section.style.marginTop = "4rem";
            section.innerHTML = `
              <p class="section__subheader">PRICING TABLE</p>
              <h2 class="section__header">${category} Rates</h2>
              <div class="membership__grid"></div>
            `;
            const grid = section.querySelector('.membership__grid');
            data[category].forEach(plan => {
              const card = document.createElement('div');
              card.className = 'membership__card';
              card.innerHTML = `
                <h4>${plan.name}</h4>
                <h2><sup>₱</sup>${Number(plan.price).toLocaleString()}</h2>
                <h3>Valid for ${plan.duration}</h3>
                <h4>ENJOY ALL THE FEATURES</h4>
                ${plan.description.split('\\n').map(line => `<p>${line}</p>`).join('')}
                <a href="#" class="btn membership__btn" onclick='handleMembershipSelect(${JSON.stringify(plan).replace(/'/g, "&apos;")})'>GET STARTED</a>
              `;
              grid.appendChild(card);
            });
            container.appendChild(section);
          }
        });
    </script>

    <footer class="footer" id="contact">
      <div class="section__container footer__container">
        <div class="footer__col">
          <div class="footer__logo"><a href="#">The Breathing Room PH</a></div>
        </div>
        <div class="footer__col">
          <p>Unit 8D, Icon Plaza, 26th St, Taguig, Metro Manila</p>
        </div>
        <div class="footer__col">
          <div class="footer__socials">
            <a href="https://www.facebook.com/thebreathingroom.ph"><i class="ri-facebook-fill"></i></a>
            <a href="https://www.instagram.com/breathingroom.ph/"><i class="ri-instagram-line"></i></a>
          </div>
        </div>
      </div>
      <div class="section__container footer__bar">
        Copyright © 2025 The Breathing Room PH. All rights reserved.
      </div>
    </footer>

  </body>
</html>
